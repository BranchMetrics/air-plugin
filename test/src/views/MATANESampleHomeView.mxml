<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" title="MobileAppTracking ANE Test App"
        xmlns:s="library://ns.adobe.com/flex/spark" 
        xmlns:MobileAppTracker="com.hasoffers.nativeExtensions.MobileAppTracker">

    <fx:Script>
        <![CDATA[
            import com.hasoffers.nativeExtensions.MobileAppTracker;
            import com.hasoffers.nativeExtensions.TuneBannerPosition;
            
            import flash.utils.Dictionary;
            
            public var mat:MobileAppTracker;
            
            public var isAndroidPlatform:Boolean;
            
            public var flagAutoGenerateParams:Boolean = false;

            public function init():void 
            {
                var platform:String = String(Capabilities.manufacturer);
                isAndroidPlatform = -1 != platform.toLowerCase().search("linux");
                
                trace("MATANESampleHomeView.init() start");
                
                trace("MATANESampleHomeView.init(): getting MobileAppTracker singleton instance.");
                mat = MobileAppTracker.instance;
                
                trace("MATANESampleHomeView.init() end");
            }

            private function tuneDeeplinkCallback(event:StatusEvent):void {
                // Handle deferred deeplink here
                trace(event.code + "::" + event.level);
                mat.setDeepLink(event.level);
            }

            private function tuneDeeplinkFailedCallback(event:StatusEvent):void {
                trace(event.code + "::" + event.level);
            }

            private function tuneShowBanner(event:Event):void {
                var adMetadata:Dictionary = new Dictionary();
                adMetadata.birthDate = new Date().toUTCString();
                var customTargets:Dictionary = new Dictionary();
                customTargets.type = "game";
                customTargets.subtype1 = "adventure";
                customTargets.subtype2 = "action";
                adMetadata.customTargets = customTargets;
                adMetadata.debugMode = true;
                adMetadata.gender = 0;
                adMetadata.latitude = 111.11;
                adMetadata.longitude = 222.22;
                adMetadata.keywords = new Array("pro", "evening");
                
                mat.showBannerWithMetadataAndPosition("TestBanner", adMetadata, TuneBannerPosition.TOP_CENTER);
            }
            
            private function tuneHideBanner(event:Event):void {
                mat.hideBanner();
            }

            protected function startMAT_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Start MAT clicked");
                var matAdvertiserId:String = "877";
                var matConversionKey:String = "8c14d6bbe466b65211e781d62e301eec";
                var matPackageName:String = "com.hasoffers.airtestapp";

                mat.init(matAdvertiserId, matConversionKey);
                mat.setPackageName(matPackageName);
                
                // Add event listeners for TUNE_DEEPLINK, TUNE_DEEPLINK_FAILED before checking for deferred deeplinks
                mat.addEventListener(MobileAppTracker.TUNE_DEEPLINK, tuneDeeplinkCallback);
                mat.addEventListener(MobileAppTracker.TUNE_DEEPLINK_FAILED, tuneDeeplinkFailedCallback);
                
                mat.addEventListener(flash.events.Event.ACTIVATE, tuneShowBanner);
                mat.addEventListener(flash.events.Event.DEACTIVATE, tuneHideBanner);

                mat.checkForDeferredDeeplink();
            }
            
            protected function debugMode_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Debug Mode clicked");
                mat.setDebugMode(true);
            }
            
            protected function allowDuplicates_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Allow Duplicates clicked");
                mat.setAllowDuplicates(true);
            }
            
            protected function delegate_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Set Delegate clicked");
                mat.setDelegate(true);
            }
            
            protected function measureSession_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Measure Session clicked");
                mat.measureSession();
            }
            
            protected function measureEvent_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Measure Event clicked");
                mat.measureEventName("evt123");
            }
            
            protected function measureEventWithEventItems_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Measure Event With Event Items clicked");
                var matEvent:Dictionary = new Dictionary();
                matEvent.name = "evt123WithEventItems";
                matEvent.revenue = 0.42;
                matEvent.currency = "USD";
                matEvent.advertiserRefId = "ref111";
                matEvent.attribute1 = "test_attribute1";
                matEvent.attribute2 = "test_attribute2";
                matEvent.attribute3 = "test_attribute3";
                matEvent.attribute4 = "test_attribute4";
                matEvent.attribute5 = "test_attribute5";

                matEvent.contentId = "testContentId";
                matEvent.contentType = "testContentType";
                matEvent.date1 = new Date().toUTCString();
                matEvent.date2 = new Date().toUTCString();
                matEvent.level = 3;
                matEvent.quantity = 2;
                matEvent.rating = 4.5;
                matEvent.searchString = "testSearchString";

                var arrEvents:Array = new Array();
                
                var dict1:Dictionary = new Dictionary();
                dict1.item = "item1";
                dict1.unit_price = 1.11;
                dict1.quantity = 1;
                dict1.revenue = 1.11;
                dict1.attribute1 = "attr11";
                dict1.attribute2 = "attr12";
                dict1.attribute3 = "";
                dict1.attribute4 = null;
                dict1.attribute5 = "";
                
                arrEvents.push(dict1);
                
                var dict2:Dictionary = new Dictionary();
                dict2.item = "item1";
                dict2.unit_price = 0.99;
                dict2.quantity = 2;
                dict2.revenue = 1.5;
                dict2.attribute1 = "attr21";
                dict2.attribute2 = null;
                dict2.attribute3 = "attr23";
                dict2.attribute4 = "";
                dict2.attribute5 = "attr25";
                
                arrEvents.push(dict2);

                matEvent.eventItems = arrEvents;
                
                var storeReceipt:String = isAndroidPlatform ? null : getSampleiTunesIAPReceipt();
                matEvent.receipt = storeReceipt;

                mat.measureEvent(matEvent);
            }
            
            protected function testSetterMethods_clickHandler(event:MouseEvent):void
            {
                trace("MATANESampleHomeView Test Setters clicked");
                mat.setAge(34);
                mat.setAllowDuplicates(true);
                mat.setAppAdTracking(true);
                mat.setAppleAdvertisingIdentifier("1234567890", true);
                mat.setAppleVendorIdentifier("87654321-4321-4321-4321-210987654321");
                mat.setCurrencyCode("CAD");
                mat.setDebugMode(true);
                mat.setDelegate(true);
                
                mat.setExistingUser(false);
                mat.setFacebookUserId("temp_facebook_user_id");
                mat.setGender(0);
                mat.setGoogleAdvertisingId("1234567890", true);
                mat.setGoogleUserId("temp_google_user_id");
                mat.setJailbroken(false);
                mat.setLocation(111,222,333);
                mat.setPackageName("com.tempcompany.tempapp");
                mat.setRedirectUrl("http://www.example.com");
                mat.setShouldAutoDetectJailbroken(true);
                mat.setShouldAutoGenerateAppleVendorIdentifier(true);
                mat.setSiteId("mat_site_id");
                mat.setTRUSTeId("1234567890");
                mat.setTwitterUserId("temp_twitter_user_id");
                mat.setUseCookieTracking(false);
                mat.setUserEmail("tempuser@tempcompany.com");
                mat.setUserId("temp_user_id");
                mat.setUserName("temp_user_name");
                mat.setPhoneNumber("123-456-7890");
                mat.setPayingUser(false);
            }
            
            protected function testGetterMethods_clickHandler(event:MouseEvent):void
            {
                var advertisingId:String = mat.getAdvertisingId();
                var matId:String = mat.getMatId();
                var openLogId:String = mat.getOpenLogId();
                var payingUser:Boolean = mat.getIsPayingUser();
                
                trace("MATANESampleHomeView testGetterMethods: advertisingId = " + advertisingId);
                trace("MATANESampleHomeView testGetterMethods: matId = " + matId);
                trace("MATANESampleHomeView testGetterMethods: openLogId = " + openLogId);
                trace("MATANESampleHomeView testGetterMethods: payingUser = " + payingUser);
            }
            
            protected function showBanner_clickHandler(event:MouseEvent):void
            {
                tuneShowBanner(event);
            }
            
            protected function hideBanner_clickHandler(event:MouseEvent):void
            {
                tuneHideBanner(event);
            }
            
            protected function destroyBanner_clickHandler(event:MouseEvent):void
            {
                mat.destroyBanner();
            }
            
            protected function cacheInterstitial_clickHandler(event:MouseEvent):void
            {
                mat.cacheInterstitial("TestInterstitial");
            }
            
            protected function showInterstitial_clickHandler(event:MouseEvent):void
            {
                mat.showInterstitial("TestInterstitial");
            }
            
            protected function getSampleiTunesIAPReceipt():String
            {
                return "{\"signature\" = \"AiuR/oePW4lQq2qAFerYcL/lU7HB7rqPKoddrjnqLUqvLywbSukO3OUwWwiRGE8iFiNvaqVF2CaG8siBkfkP5KYaeiTHT2RNLCIKyCfhOIr4q0wYCKwxNp2vdo3S8b+4boeSAXzgzBHCR1S1hTN5LuoeRzDeIWHoYT66CBweqDetAAADVzCCA1MwggI7oAMCAQICCGUUkU3ZWAS1MA0GCSqGSIb3DQEBBQUAMH8xCzAJBgNVBAYTAlVTMRMwEQYDVQQKDApBcHBsZSBJbmMuMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEzMDEGA1UEAwwqQXBwbGUgaVR1bmVzIFN0b3JlIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MB4XDTA5MDYxNTIyMDU1NloXDTE0MDYxNDIyMDU1NlowZDEjMCEGA1UEAwwaUHVyY2hhc2VSZWNlaXB0Q2VydGlmaWNhdGUxGzAZBgNVBAsMEkFwcGxlIGlUdW5lcyBTdG9yZTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMrRjF2ct4IrSdiTChaI0g8pwv/cmHs8p/RwV/rt/91XKVhNl4XIBimKjQQNfgHsDs6yju++DrKJE7uKsphMddKYfFE5rGXsAdBEjBwRIxexTevx3HLEFGAt1moKx509dhxtiIdDgJv2YaVs49B0uJvNdy6SMqNNLHsDLzDS9oZHAgMBAAGjcjBwMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAUNh3o4p2C0gEYtTJrDtdDC5FYQzowDgYDVR0PAQH/BAQDAgeAMB0GA1UdDgQWBBSpg4PyGUjFPhJXCBTMzaN+mV8k9TAQBgoqhkiG92NkBgUBBAIFADANBgkqhkiG9w0BAQUFAAOCAQEAEaSbPjtmN4C/IB3QEpK32RxacCDXdVXAeVReS5FaZxc+t88pQP93BiAxvdW/3eTSMGY5FbeAYL3etqP5gm8wrFojX0ikyVRStQ+/AQ0KEjtqB07kLs9QUe8czR8UGfdM1EumV/UgvDd4NwNYxLQMg4WTQfgkQQVy8GXZwVHgbE/UC6Y7053pGXBk51NPM3woxhd3gSRLvXj+loHsStcTEqe9pBDpmG5+sk4tw+GK3GMeEN5/+e1QT9np/Kl1nj+aBw7C0xsy0bFnaAd1cSS6xdory/CUvM6gtKsmnOOdqTesbp0bs8sn6Wqs0C9dgcxRHuOMZ2tm8npLUm7argOSzQ==\";\"purchase-info\" = \"ewoJIm9yaWdpbmFsLXB1cmNoYXNlLWRhdGUtcHN0IiA9ICIyMDEzLTA2LTE5IDEzOjMyOjE5IEFtZXJpY2EvTG9zX0FuZ2VsZXMiOwoJInVuaXF1ZS1pZGVudGlmaWVyIiA9ICJjODU0OGI1YWExZjM5NDA2NmY1ZWEwM2Q3ZGU0YTBiYzdjMTEyZDk5IjsKCSJvcmlnaW5hbC10cmFuc2FjdGlvbi1pZCIgPSAiMTAwMDAwMDA3Nzk2MDgzNSI7CgkiYnZycyIgPSAiMS4xIjsKCSJ0cmFuc2FjdGlvbi1pZCIgPSAiMTAwMDAwMDA4MzE1MjA1NCI7CgkicXVhbnRpdHkiID0gIjEiOwoJIm9yaWdpbmFsLXB1cmNoYXNlLWRhdGUtbXMiID0gIjEzNzE2NzM5MzkwMDAiOwoJInVuaXF1ZS12ZW5kb3ItaWRlbnRpZmllciIgPSAiQTM3MjFCQzctNDA3Qi00QzcyLTg4RDAtMTdGNjIwRUMzNzEzIjsKCSJwcm9kdWN0LWlkIiA9ICJjb20uaGFzb2ZmZXJzLmluYXBwcHVyY2hhc2V0cmFja2VyMS5iYWxsIjsKCSJpdGVtLWlkIiA9ICI2NTMyMzA4MjkiOwoJImJpZCIgPSAiY29tLkhhc09mZmVycy5JbkFwcFB1cmNoYXNlVHJhY2tlcjEiOwoJInB1cmNoYXNlLWRhdGUtbXMiID0gIjEzNzU4MTM2NDcxMDIiOwoJInB1cmNoYXNlLWRhdGUiID0gIjIwMTMtMDgtMDYgMTg6Mjc6MjcgRXRjL0dNVCI7CgkicHVyY2hhc2UtZGF0ZS1wc3QiID0gIjIwMTMtMDgtMDYgMTE6Mjc6MjcgQW1lcmljYS9Mb3NfQW5nZWxlcyI7Cgkib3JpZ2luYWwtcHVyY2hhc2UtZGF0ZSIgPSAiMjAxMy0wNi0xOSAyMDozMjoxOSBFdGMvR01UIjsKfQ==\";\"environment\" = \"Sandbox\";\"pod\" = \"100\";\"signing-status\" = \"0\";}";
            }
        ]]>
    </fx:Script>
    
    <s:Scroller width="100%" height="100%">
        <s:Group width="100%" height="100%" initialize="init()" >
            <s:Button label="Start MAT" click="startMAT_clickHandler(event)" horizontalCenter="0" width="80%" top="10" />
            <s:Button label="Enable Delegate" click="delegate_clickHandler(event)" horizontalCenter="0" width="80%" top="60" />
            <s:Button label="Enable Debug Mode" click="debugMode_clickHandler(event)" horizontalCenter="0" width="80%" top="110" />
            <s:Button label="Allow Duplicates" click="allowDuplicates_clickHandler(event)" horizontalCenter="0" width="80%" top="160" />
            <s:Button label="Measure session" click="measureSession_clickHandler(event)" horizontalCenter="0" width="80%" top="210" />
            <s:Button label="Measure event" click="measureEvent_clickHandler(event)" horizontalCenter="0" width="80%" top="260"/>
            <s:Button label="Measure event with event item" click="measureEventWithEventItems_clickHandler(event)" horizontalCenter="0" width="80%" top="310"/>
            <s:Button label="Test Setter Methods" click="testSetterMethods_clickHandler(event)" horizontalCenter="0" width="80%" top="360"/>
            <s:Button label="Test Getter Methods" click="testGetterMethods_clickHandler(event)" horizontalCenter="0" width="80%" top="410"/>
            <s:Button label="Show Banner" click="showBanner_clickHandler(event)" horizontalCenter="0" width="80%" top="460"/>
            <s:Button label="Hide Banner" click="hideBanner_clickHandler(event)" horizontalCenter="0" width="80%" top="510"/>
            <s:Button label="Destroy Banner" click="destroyBanner_clickHandler(event)" horizontalCenter="0" width="80%" top="560"/>
            <s:Button label="Cache Interstitial" click="cacheInterstitial_clickHandler(event)" horizontalCenter="0" width="80%" top="610"/>
            <s:Button label="Show Interstitial" click="showInterstitial_clickHandler(event)" horizontalCenter="0" width="80%" top="660"/>
        </s:Group>
    </s:Scroller>
</s:View>